## Issue 20 — Medidas: modelo de dados + cache de medidas por aresta (Figure/Edges)

### Objetivo
Implementar cálculo e **cache persistido de medidas** por figura (Figure) e por aresta (Edge), compatível com o modelo atual **Figure-based v2 (nodes + edges)**, para servir de base à feature de “Medidas/Dimensões” (estilo desenho técnico).

Esta issue **não renderiza** nada no canvas (Konva/UX fica para outra issue). É apenas: tipos + cálculo + atualização do cache.

### Requisitos funcionais
- Cada `Figure` deve poder armazenar um cache de medidas (persistido no `design_data`).
- O cache deve ser calculado a partir do grafo `nodes` + `edges` e da transformação (`x`, `y`, `rotation`).
- O cache deve ser atualizado quando a geometria mudar:
	- desenho em progresso (atualiza em tempo real, sem “sujar” histórico),
	- mover (drag),
	- transform (resize/rotate),
	- edição de nós/handles (Node tool).

### O que medir (por tool)
- `tool: "rectangle"`:
	- 4 arestas (uma por `edge`), cada uma com comprimento (e opcionalmente ângulo).
	- Identidade estável via `edge.id` (o retângulo mantém as arestas; o valor muda, o ID não).
- `tool: "line"`:
	- 1 aresta com comprimento.
- `tool: "circle"` (representado como cubics):
	- raio e diâmetro derivados da geometria (ex.: distância média dos nós ao centro local),
	- opcional: circunferência aproximada.
- `tool: "curve"`:
	- comprimento aproximado (amostragem),
	- opcional: ângulo da tangente em t≈0.5 e raio de curvatura aproximado em t≈0.5.

### Proposta de modelagem (TypeScript)
- Adicionar em `Figure` um campo opcional, por exemplo `dimensions`, contendo:
	- `version` (para evoluções),
	- `figureLengthPx` (quando fizer sentido),
	- `perEdge`: mapa/array por `edgeId` com `{ lengthPx, angleDeg? }`,
	- extras por tool (ex.: `radiusPx`, `diameterPx`).

### Cálculo (alto nível)
- Converter para world coords aplicando `x/y/rotation` da figura.
- `EdgeKind: "line"`: comprimento direto entre nós.
- `EdgeKind: "cubic"`: comprimento aproximado por amostragem do Bézier.
- Para círculo (cubics): derivar raio a partir da geometria local.

### Critérios de aceite
- Figuras novas/atualizadas possuem cache consistente com `nodes/edges`.
- Retângulo/linha reportam medidas por `edge.id`.
- Curva reporta comprimento aproximado (e, se implementado, ângulo/raio aprox).
- Desenho em progresso atualiza medidas sem poluir undo/redo.

### Fora de escopo
- Renderizar medidas no canvas.
- UI/botões de modo.


## Issue 19 — Medidas: renderização Konva + modos (sempre/nunca/hover+selecionada)

### Objetivo
Renderizar “Medidas/Dimensões” no canvas (Konva), usando o cache calculado na Issue 20 e o modelo atual **Figure/Edges**, com 3 modos:

1) Sempre exibir
2) Nunca exibir
3) Exibir no hover (e também na selecionada)

### UX / comportamento
- Adicionar um botão/controle na toolbar para alternar os 3 modos.
- Quando modo = “hover”:
	- mostrar medidas da figura em hover;
	- se houver figura selecionada, mostrar também (mesmo sem hover).
- Durante desenho (antes de finalizar), mostrar medidas em tempo real da figura em draft.

### Render (discreto)
- Texto pequeno e discreto (estilo engenharia).
- Medidas ligeiramente afastadas da aresta (offset para fora).
- Texto deve manter tamanho consistente em tela apesar do zoom:
	- usar `fontSize` proporcional a `1/scale` (ou técnica equivalente),
	- `listening={false}` para não interferir em interação.

### Por tool
- Retângulo: 4 medidas (uma por aresta/edge).
- Linha: 1 medida (comprimento).
- Círculo: exibir `R` e `⌀` próximos ao círculo.
- Curva: exibir comprimento (e, se existir no cache, ângulo/raio aprox).

### Regras
- Não exibir medidas para figuras derivadas `kind: "seam"` (margem de costura) por padrão.
- No modo “nunca”, não renderizar nada (zero custo extra de draw).

### Critérios de aceite
- Toggle de modo funciona e reflete imediatamente.
- “Sempre”: todas as figuras base exibem medidas.
- “Hover”: mostra medidas do hover + selecionada.
- “Nunca”: nada exibido.
- Medidas atualizam durante desenho e após editar geometria.
- Zoom não “explode” o texto.